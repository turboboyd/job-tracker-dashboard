"use strict";(self.webpackChunkjob_tracker_dashboard=self.webpackChunkjob_tracker_dashboard||[]).push([[7167],{67167(t,e,o){o.d(e,{BC:()=>N,C9:()=>_,zQ:()=>v,tM:()=>b,Ag:()=>g,Di:()=>T,b7:()=>D,De:()=>k,mx:()=>I,Ms:()=>M,Fr:()=>O,m1:()=>R});var s=o(24589);function a(t){return t.toLowerCase().replace(/[^a-z0-9а-яё#+.\s-]/gi," ").replace(/\s+/g," ").trim()}function n(t,e){return{...t,vacancy:{...t.vacancy??{},roleFingerprint:e}}}const r=864e5;function c(){return s.Dc.now()}function i(t,e){return s.Dc.fromMillis(t.toMillis()+e*r)}function l(t,e){return Math.floor(Math.abs(t.toMillis()-e.toMillis())/r)}function p(t,e,o){const s=e.vacancy?.roleFingerprint??function(t){return`rf_${function(t){let e=5381;for(let o=0;o<t.length;o+=1)e=33*e^t.charCodeAt(o);return(e>>>0).toString(36)}(a(`${t.job.companyName}::${t.job.roleTitle}::${t.job.locationText??""}`))}`}(e),r=n(e,s),c=function(t,e,o){if(!t)return;const s=a([e.job.roleTitle,e.job.companyName,e.job.locationText??"",e.vacancy?.rawDescription??"",(e.notes?.tags??[]).join(" ")].join(" ")),n=(t.skills??[]).slice().sort((t,e)=>(e.level??0)-(t.level??0));if(0===n.length)return;const r=[],c=[];for(const t of n){const e=a(t.key),o=a(t.label);e&&s.includes(e)||o&&s.includes(o)?r.push(t.label||t.key):c.push(t.label||t.key)}const i=r.slice(0,10),l=c.slice(0,10),p=n.length,u=r.length,d=Math.round(u/p*100),f={};if(t.matchSettings?.hardFilters){const o=t.matchSettings.hardFilters,s=e.job.workMode;"REMOTE"!==s||o.allowRemote||(f.allowRemote=!1),"HYBRID"!==s||o.allowHybrid||(f.allowHybrid=!1),"ON_SITE"!==s||o.allowOnSite||(f.allowOnSite=!1)}const y={skills:d,experience:0,language:0,location:0,domain:0,salary:0};let m=d;Object.values(f).some(t=>!1===t)&&(m=Math.max(0,m-30));let w="maybe";return m>=70?w="match":m<35&&(w="skip"),{decision:w,score:m,breakdown:y,hardFilterFlags:f,matchedSkillsTop:i,gapsTop:l,computedAt:o,confidence:Math.min(1,.3+(e.vacancy?.rawDescription?.3:0)+Math.min(.4,n.length/25))}}(t,r,o),p=function(t,e){const o=t.process.status;if(!["APPLIED","VIEWED","INTERVIEW_1","INTERVIEW_2","TEST_TASK"].includes(o))return{needsFollowUp:!1,followUpDueAt:void 0,followUpLevel:t.process.followUpLevel??0};const s=t.process.lastContactAt??t.process.lastStatusChangeAt,a=t.process.lastFollowUpAt,n=l(s,e),r=a?l(a,e):999,c=i(s,7),p=e.toMillis()>=c.toMillis(),u=n>=7&&r>=7&&p;return{needsFollowUp:u,followUpDueAt:u?c:void 0,followUpLevel:t.process.followUpLevel??0}}({...r,matching:c},o),u=function(t,e){const o=t.process.status;if(!["REJECTED","NO_RESPONSE"].includes(o))return{needsReapplySuggestion:!1,reapplyEligibleAt:void 0,reapplyReason:void 0};const s=i(t.process.lastStatusChangeAt,30),a=e.toMillis()>=s.toMillis();return{needsReapplySuggestion:a,reapplyEligibleAt:a?s:void 0,reapplyReason:a?"cooldown_elapsed":void 0}}({...r,matching:c,process:{...r.process,...p}},o),d=function(t,e){const o=[];let s=0;switch(t.process.status){case"SAVED":s=75,o.push("saved_new");break;case"PLANNED":s=70,o.push("planned");break;case"APPLIED":s=60,o.push("applied");break;case"VIEWED":s=58,o.push("viewed");break;case"INTERVIEW_1":s=52,o.push("interview");break;case"INTERVIEW_2":s=45,o.push("interview_2");break;case"TEST_TASK":s=50,o.push("test_task");break;case"OFFER":s=30,o.push("offer");break;case"REJECTED":case"NO_RESPONSE":s=10,o.push("closed");break;default:s=40}return t.job.vacancyUrl&&(s+=5,o.push("has_url")),t.process.needsFollowUp&&(s+=10,o.push("followup_due")),t.process.needsReapplySuggestion&&(s+=6,o.push("reapply_possible")),"match"===t.matching?.decision?(s+=6,o.push("strong_match")):"skip"===t.matching?.decision&&(s-=8,o.push("weak_match")),s=Math.max(0,Math.min(100,s)),{score:s,reasons:o,computedAt:e}}({...r,matching:c,process:{...r.process,...p,...u}},o);return{roleFingerprint:s,matching:c,followUp:p,reapply:u,priority:d}}function u(t){if(null==t)return t;if(t instanceof s.Dc)return t;if(Array.isArray(t))return t.filter(t=>void 0!==t).map(t=>u(t));if("object"==typeof t){const e={};for(const[o,s]of Object.entries(t))void 0!==s&&(e[o]=u(s));return e}return t}function d(t,e){return(0,s.H9)(function(t){return(0,s.rJ)(t,"users")}(t),e)}function f(t,e){return(0,s.rJ)(t,"users",e,"applications")}function y(t,e,o){return(0,s.H9)(t,"users",e,"applications",o)}function m(t,e,o){return(0,s.rJ)(t,"users",e,"applications",o,"history")}function w(t,e,o,a){return(0,s.H9)(t,"users",e,"applications",o,"history",a)}function h(t){if(Array.isArray(t))return t.map(t=>h(t));if(function(t){if(!t||"object"!=typeof t)return!1;const e=Object.getPrototypeOf(t);return e===Object.prototype||null===e}(t)){const e={};for(const[o,s]of Object.entries(t))e[o]=h(s);return e}return t}async function E(t,e){const o=d(t,e),a=await(0,s.x7)(o);return a.exists()?a.data():null}async function g(t,e){const o=d(t,e);if((await(0,s.x7)(o)).exists())return;const a=c(),n={createdAt:a,updatedAt:a,profile:{location:{timezone:"Europe/Berlin"}},skills:[],matchSettings:{weights:{skills:45,experience:20,language:10,location:10,domain:10,salary:5},hardFilters:{allowOnSite:!0,allowHybrid:!0,allowRemote:!0},skillSynonymsVersion:1}},r=(0,s.wP)(t);r.set(o,u(n)),await r.commit()}function A(t){return"object"==typeof t&&null!==t}function S(t){return null==t?0:"number"==typeof t?t:t instanceof Date?t.getTime():function(t){return A(t)&&"function"==typeof t.toMillis}(t)?t.toMillis():function(t){return A(t)&&"number"==typeof t.seconds}(t)?1e3*t.seconds:0}async function b(t,e,o){await g(t,e);const a=o.loopId??"manual";if(!o.loopId){const o=(0,s.H9)(t,"users",e,"loops",a);if(!(await(0,s.x7)(o)).exists()){const t=c();await(0,s.BN)(o,{name:"Manual",titles:[],location:"",radiusKm:0,remoteMode:"manual",platforms:[],filters:{},createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),createdAtTs:t,updatedAtTs:t})}}const r=(0,s.H9)(f(t,e)).id,i=y(t,e,r),l=c(),d=o.status??"SAVED",h={createdAt:l,updatedAt:l,createdBy:e,archived:!1,job:{companyName:o.companyName,roleTitle:o.roleTitle,vacancyUrl:o.vacancyUrl,source:o.source,locationText:o.locationText,workMode:o.workMode,employmentType:o.employmentType},process:{status:d,lastStatusChangeAt:l,contactAttempts:0,followUpLevel:0,needsFollowUp:!1,needsReapplySuggestion:!1},notes:{currentNote:o.currentNote,tags:o.tags??[]},vacancy:o.rawDescription?{rawDescription:o.rawDescription,roleFingerprint:void 0}:void 0,loopLinkage:{loopId:a,platform:o.loopPlatform,matchedAt:o.loopMatchedAt?s.Dc.fromDate(o.loopMatchedAt):void 0,source:o.loopSource??(o.loopId?"loop":"manual"),legacyMatchId:o.legacyMatchId}},A=p(await E(t,e),h,l),S={...n(h,A.roleFingerprint),matching:A.matching,process:{...h.process,...A.followUp,...A.reapply},priority:A.priority},b=(0,s.wP)(t);b.set(i,u(S));const T=w(t,e,r,(0,s.H9)(m(t,e,r)).id),D={createdAt:l,actor:"system",type:"SYSTEM",comment:"Application created"};return b.set(T,u(D)),await b.commit(),r}async function T(t,e,o){const a=y(t,e,o),n=await(0,s.x7)(a);return n.exists()?n.data():null}async function D(t,e,o,a=50){const n=(0,s.P)(m(t,e,o),(0,s.My)("createdAt","desc"),(0,s.AB)(a));return(await(0,s.GG)(n)).docs.map(t=>({id:t.id,data:t.data()}))}async function R(t,e,o,a,n){const r=y(t,e,o),i=await(0,s.x7)(r);if(!i.exists())throw new Error(`Application ${o} not found`);const l=i.data(),d=c(),f={...a,updatedAt:d},g=function(t,e){const o=h(t);for(const[t,s]of Object.entries(e)){if(!t.includes(".")){o[t]=s;continue}const e=t.split(".");let a=o;for(let t=0;t<e.length-1;t+=1){const o=e[t],s=a[o];s&&"object"==typeof s||(a[o]={}),a=a[o]}a[e[e.length-1]]=s}return o}(l,f),A=p(await E(t,e),g,d),S=u({...f,...(b=A,{"vacancy.roleFingerprint":b.roleFingerprint,matching:b.matching,priority:b.priority,"process.needsFollowUp":b.followUp.needsFollowUp,"process.followUpDueAt":b.followUp.followUpDueAt,"process.followUpLevel":b.followUp.followUpLevel,"process.needsReapplySuggestion":b.reapply.needsReapplySuggestion,"process.reapplyEligibleAt":b.reapply.reapplyEligibleAt,"process.reapplyReason":b.reapply.reapplyReason})});var b;const T=function(t,e){return t.map(t=>({...t,createdAt:t.createdAt??e}))}(n(l),d),D=(0,s.wP)(t);D.update(r,S),function(t,e,o,a,n){for(const r of n){const n=w(e,o,a,(0,s.H9)(m(e,o,a)).id);t.set(n,u(r))}}(D,t,e,o,T),await D.commit()}async function v(t,e,o,a){const n=y(t,e,o),r=await(0,s.x7)(n);if(!r.exists())throw new Error(`Application ${o} not found`);const i=r.data(),l=c(),p={"process.status":a,"process.lastStatusChangeAt":l},u=(t=>{switch(t){case"SAVED":default:return{stage:"ACTIVE",subStatus:"SAVED"};case"APPLIED":return{stage:"ACTIVE",subStatus:"APPLIED"};case"INTERVIEW_1":return{stage:"INTERVIEW",subStatus:"HR_CALL_SCHEDULED"};case"OFFER":return{stage:"OFFER",subStatus:"OFFER_RECEIVED"};case"REJECTED":return{stage:"REJECTED",subStatus:"REJECTED_PRE_INTERVIEW"};case"NO_RESPONSE":return{stage:"NO_RESPONSE",subStatus:"GHOSTING"}}})(a);p["process.stage"]=u.stage,p["process.subStatus"]=u.subStatus,"APPLIED"!==a||i.process.appliedAt||(p["process.appliedAt"]=l),await R(t,e,o,p,()=>[{actor:"user",type:"STATUS_CHANGE",fromStatus:i.process.status,toStatus:a}])}async function _(t,e,o,a=30){const n=24*a*60*60*1e3,r=Date.now(),i=o.filter(({data:t})=>{if(t.archived)return!1;if("NO_RESPONSE"===t.process.status)return!1;const e=t.process.appliedAt;return!!e&&e.toDate().getTime()<=r-n});if(!i.length)return 0;const l=c(),p=(0,s.wP)(t);for(const{id:o,data:a}of i){const n=y(t,e,o),r={"process.status":"NO_RESPONSE","process.lastStatusChangeAt":l,"process.stage":"NO_RESPONSE","process.subStatus":"GHOSTING",updatedAt:l};p.update(n,r);const c=w(t,e,o,(0,s.H9)(m(t,e,o)).id),i={createdAt:l,actor:"system",type:"STATUS_CHANGE",fromStatus:a.process.status,toStatus:"NO_RESPONSE",comment:"Auto-marked as GHOSTING (no response > 30 days)"};p.set(c,u(i))}return await p.commit(),i.length}async function N(t,e,o,s){await R(t,e,o,{},()=>[{actor:"user",type:"COMMENT",comment:s.text,feedbackType:s.feedbackType,sentiment:s.sentiment,rejectionReasonCode:s.rejectionReasonCode}])}async function M(t,e,o,a=50){const n=(0,s.P)(f(t,e),(0,s._M)("process.status","==",o),(0,s.AB)(3*a));return(await(0,s.GG)(n)).docs.map(t=>({id:t.id,data:t.data()})).filter(t=>!t.data.archived).sort((t,e)=>S(e.data.process.lastStatusChangeAt)-S(t.data.process.lastStatusChangeAt)).slice(0,a)}async function O(t,e,o=20){const a=(0,s.P)(f(t,e),(0,s.My)("priority.score","desc"),(0,s.AB)(3*o));return(await(0,s.GG)(a)).docs.map(t=>({id:t.id,data:t.data()})).filter(t=>!t.data.archived).slice(0,o)}async function I(t,e,o=50){const a=(0,s.P)(f(t,e),(0,s._M)("process.needsFollowUp","==",!0),(0,s.AB)(3*o));return(await(0,s.GG)(a)).docs.map(t=>({id:t.id,data:t.data()})).filter(t=>!t.data.archived).sort((t,e)=>S(t.data.process.followUpDueAt)-S(e.data.process.followUpDueAt)).slice(0,o)}async function k(t,e,o=500){const a=(0,s.P)(f(t,e),(0,s._M)("archived","==",!1),(0,s.AB)(o));return(await(0,s.GG)(a)).docs.map(t=>({id:t.id,data:t.data()}))}}}]);
//# sourceMappingURL=7167.9978eee3.chunk.js.map