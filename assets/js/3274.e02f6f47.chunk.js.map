{"version":3,"file":"assets/js/3274.e02f6f47.chunk.js","mappings":"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","sources":["webpack://job-tracker-dashboard/./src/features/cvVersions/firestoreCvVersions.ts","webpack://job-tracker-dashboard/./src/pages/CvBuilderPage/CvBuilderPage.tsx"],"sourcesContent":["// src/features/cvVersions/firestoreCvVersions.ts\nimport {\n  Firestore,\n  Timestamp,\n  collection,\n  doc,\n  getDocs,\n  orderBy,\n  query,\n  setDoc,\n  updateDoc,\n} from \"firebase/firestore\";\nimport { FirebaseStorage, getDownloadURL, ref, uploadBytes } from \"firebase/storage\";\n\nexport type CvVersionDoc = {\n  createdAt: Timestamp;\n  updatedAt: Timestamp;\n  label: string;\n  filePath: string;\n  fileName: string;\n  sizeBytes: number;\n  mimeType: string;\n  notes?: string;\n  // Optional: you can compute later\n  hashSha256?: string;\n};\n\nfunction nowTs(): Timestamp {\n  return Timestamp.now();\n}\n\nfunction cvVersionsCol(db: Firestore, userId: string) {\n  return collection(db, \"users\", userId, \"cv_versions\");\n}\n\nexport async function listCvVersions(\n  db: Firestore,\n  userId: string,\n  take: number = 50\n): Promise<Array<{ id: string; data: CvVersionDoc }>> {\n  const q = query(cvVersionsCol(db, userId), orderBy(\"createdAt\", \"desc\"));\n  const snap = await getDocs(q);\n  return snap.docs.slice(0, take).map((d) => ({ id: d.id, data: d.data() as CvVersionDoc }));\n}\n\nexport async function uploadCvVersion(\n  db: Firestore,\n  storage: FirebaseStorage,\n  userId: string,\n  input: {\n    file: File;\n    label?: string;\n    notes?: string;\n  }\n): Promise<string> {\n  const cvId = doc(cvVersionsCol(db, userId)).id;\n  const t = nowTs();\n\n  const file = input.file;\n  const safeName = file.name.replace(/\\s+/g, \"_\");\n  const filePath = `users/${userId}/cv_versions/${cvId}/${safeName}`;\n  const storageRef = ref(storage, filePath);\n\n  await uploadBytes(storageRef, file);\n\n  const docRef = doc(db, \"users\", userId, \"cv_versions\", cvId);\n  const payload: CvVersionDoc = {\n    createdAt: t,\n    updatedAt: t,\n    label: input.label?.trim() || safeName,\n    filePath,\n    fileName: file.name,\n    sizeBytes: file.size,\n    mimeType: file.type || \"application/octet-stream\",\n    notes: input.notes?.trim() || undefined,\n  };\n\n  await setDoc(docRef, payload);\n  return cvId;\n}\n\nexport async function getCvDownloadUrl(storage: FirebaseStorage, filePath: string): Promise<string> {\n  return getDownloadURL(ref(storage, filePath));\n}\n\nexport async function renameCvVersion(\n  db: Firestore,\n  userId: string,\n  cvId: string,\n  label: string\n): Promise<void> {\n  const ref = doc(db, \"users\", userId, \"cv_versions\", cvId);\n  await updateDoc(ref, { label, updatedAt: nowTs() });\n}\n","import { useEffect, useMemo, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n\nimport { useAuthSelectors } from \"src/entities/auth\";\nimport {\n  getCvDownloadUrl,\n  listCvVersions,\n  uploadCvVersion,\n  type CvVersionDoc,\n} from \"src/features/cvVersions/firestoreCvVersions\";\nimport { db, storage } from \"src/shared/config/firebase/firebase\";\nimport { Button, Card, InlineError } from \"src/shared/ui\";\nimport { Input } from \"src/shared/ui/Form/Input\";\n\n\ntype CvRow = { id: string; data: CvVersionDoc; downloadUrl?: string };\n\nfunction errorMessage(e: unknown): string {\n  if (e instanceof Error) return e.message;\n  if (typeof e === \"string\") return e;\n  try {\n    return JSON.stringify(e);\n  } catch {\n    return String(e);\n  }\n}\n\nfunction formatBytes(bytes: number): string {\n  if (!bytes) return \"0 B\";\n  const units = [\"B\", \"KB\", \"MB\", \"GB\"];\n  let i = 0;\n  let v = bytes;\n  while (v >= 1024 && i < units.length - 1) {\n    v /= 1024;\n    i += 1;\n  }\n  return `${v.toFixed(i === 0 ? 0 : 1)} ${units[i]}`;\n}\n\nexport default function CvBuilderPage() {\n  const { t } = useTranslation();\n  const { userId, isAuthReady } = useAuthSelectors();\n\n  const [file, setFile] = useState<File | null>(null);\n  const [label, setLabel] = useState(\"\");\n  const [notes, setNotes] = useState(\"\");\n\n  const [list, setList] = useState<CvRow[]>([]);\n  const [isUploading, setIsUploading] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const canUpload = useMemo(() => !!userId && !!file && !isUploading, [userId, file, isUploading]);\n\n  const listNode = useMemo(() => {\n    if (isLoading) {\n      return (\n        <div className=\"text-sm text-muted-foreground\">\n          {t(\"cvBuilder.list.loading\", \"Loading…\")}\n        </div>\n      );\n    }\n\n    if (list.length === 0) {\n      return (\n        <div className=\"text-sm text-muted-foreground\">\n          {t(\"cvBuilder.list.empty\", \"No CV versions yet.\")}\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"divide-y divide-border\">\n        {list.map((r) => (\n          <div key={r.id} className=\"py-sm flex items-center gap-md\">\n            <div className=\"min-w-0 flex-1\">\n              <div className=\"truncate text-sm font-medium text-foreground\">\n                {r.data.label || r.data.fileName}\n              </div>\n              <div className=\"truncate text-xs text-muted-foreground\">\n                {r.data.fileName} • {formatBytes(r.data.sizeBytes)} • {r.data.mimeType}\n              </div>\n              {r.data.notes ? (\n                <div className=\"mt-1 text-xs text-muted-foreground\">{r.data.notes}</div>\n              ) : null}\n            </div>\n\n            {r.downloadUrl ? (\n              <a\n                className=\"text-sm font-medium text-foreground hover:underline\"\n                href={r.downloadUrl}\n                target=\"_blank\"\n                rel=\"noreferrer\"\n              >\n                {t(\"cvBuilder.list.open\", \"Open\")}\n              </a>\n            ) : (\n              <span className=\"text-xs text-muted-foreground\">—</span>\n            )}\n          </div>\n        ))}\n      </div>\n    );\n  }, [isLoading, list, t]);\n\n  async function load() {\n    if (!userId) return;\n    setIsLoading(true);\n    setError(null);\n    try {\n      const rows = await listCvVersions(db, userId, 50);\n      // lazy resolve download urls\n      const withUrls: CvRow[] = [];\n      for (const r of rows) {\n        let url: string | undefined;\n        try {\n          url = await getCvDownloadUrl(storage, r.data.filePath);\n        } catch {\n          url = undefined;\n        }\n        withUrls.push({ id: r.id, data: r.data, downloadUrl: url });\n      }\n      setList(withUrls);\n    } catch (e: unknown) {\n      setError(errorMessage(e));\n    } finally {\n      setIsLoading(false);\n    }\n  }\n\n  useEffect(() => {\n    if (!isAuthReady || !userId) return;\n    void load();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isAuthReady, userId]);\n\n  async function onUpload() {\n    if (!userId || !file) return;\n    setIsUploading(true);\n    setError(null);\n    try {\n      await uploadCvVersion(db, storage, userId, {\n        file,\n        label: label.trim() || undefined,\n        notes: notes.trim() || undefined,\n      });\n      setFile(null);\n      setLabel(\"\");\n      setNotes(\"\");\n      await load();\n    } catch (e: unknown) {\n      setError(errorMessage(e));\n    } finally {\n      setIsUploading(false);\n    }\n  }\n\n  return (\n    <div className=\"space-y-lg\">\n      <div>\n        <div className=\"text-xl font-semibold text-foreground\">\n          {t(\"cvBuilder.title\", \"CV Builder\")}\n        </div>\n        <div className=\"text-sm text-muted-foreground\">\n          {t(\"cvBuilder.subtitle\", \"Upload CV versions and link them to applications.\")}\n        </div>\n      </div>\n\n      {error ? <InlineError message={error} /> : null}\n\n      <Card padding=\"md\" shadow=\"sm\" className=\"space-y-md\">\n        <div className=\"text-base font-semibold\">{t(\"cvBuilder.upload.title\",\"Upload CV\")}</div>\n\n        <div className=\"grid grid-cols-1 gap-md md:grid-cols-2\">\n          <div className=\"space-y-2\">\n            <div className=\"text-xs text-muted-foreground\">{t(\"cvBuilder.upload.file\",\"File\")}</div>\n            <input\n              type=\"file\"\n              accept=\".pdf,.doc,.docx\"\n              onChange={(e) => setFile(e.target.files?.[0] ?? null)}\n            />\n            {file ? (\n              <div className=\"text-xs text-muted-foreground\">\n                {file.name} • {formatBytes(file.size)}\n              </div>\n            ) : null}\n          </div>\n\n          <div className=\"space-y-2\">\n            <div className=\"text-xs text-muted-foreground\">{t(\"cvBuilder.upload.label\",\"Label\")}</div>\n            <Input\n              preset=\"default\"\n              value={label}\n              onChange={(e) => setLabel(e.target.value)}\n              placeholder={t(\"cvBuilder.upload.labelPh\",\"e.g. Frontend CV v3\")}\n            />\n          </div>\n        </div>\n\n        <div className=\"space-y-2\">\n          <div className=\"text-xs text-muted-foreground\">{t(\"cvBuilder.upload.notes\",\"Notes\")}</div>\n          <textarea\n            className=\"w-full min-h-[70px] rounded-md border border-border bg-background px-3 py-2 text-sm text-foreground outline-none focus:ring-2 focus:ring-ring\"\n            value={notes}\n            onChange={(e) => setNotes(e.target.value)}\n            placeholder={t(\"cvBuilder.upload.notesPh\",\"Optional notes…\")}\n          />\n        </div>\n\n        <div className=\"flex justify-end\">\n          <Button disabled={!canUpload} onClick={onUpload}>\n            {isUploading ? t(\"cvBuilder.upload.uploading\",\"Uploading…\") : t(\"cvBuilder.upload.upload\",\"Upload\")}\n          </Button>\n        </div>\n      </Card>\n\n      <Card padding=\"md\" shadow=\"sm\" className=\"space-y-sm\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"text-base font-semibold\">{t(\"cvBuilder.list.title\",\"CV Versions\")}</div>\n          <Button size=\"sm\" variant=\"outline\" disabled={!userId || isLoading} onClick={load}>\n            {t(\"cvBuilder.list.refresh\",\"Refresh\")}\n          </Button>\n        </div>\n\n        {listNode}\n      </Card>\n    </div>\n  );\n}\n"],"names":["cvVersionsCol","db","userId","collection","async","getCvDownloadUrl","storage","filePath","getDownloadURL","ref","errorMessage","e","Error","message","JSON","stringify","String","formatBytes","bytes","units","i","v","length","toFixed","CvBuilderPage","t","useTranslation","isAuthReady","useAuthSelectors","file","setFile","useState","label","setLabel","notes","setNotes","list","setList","isUploading","setIsUploading","isLoading","setIsLoading","error","setError","canUpload","useMemo","listNode","_jsx","className","children","map","r","_jsxs","data","fileName","sizeBytes","mimeType","downloadUrl","href","target","rel","id","load","rows","take","q","query","orderBy","getDocs","docs","slice","d","listCvVersions","withUrls","url","undefined","push","useEffect","InlineError","Card","padding","shadow","type","accept","onChange","files","name","size","Input","preset","value","placeholder","Button","disabled","onClick","input","cvId","doc","Timestamp","now","safeName","replace","storageRef","uploadBytes","docRef","payload","createdAt","updatedAt","trim","setDoc","uploadCvVersion","variant"],"ignoreList":[],"sourceRoot":""}