"use strict";(self.webpackChunkjob_tracker_dashboard=self.webpackChunkjob_tracker_dashboard||[]).push([[3274],{83274(e,t,s){s.r(t),s.d(t,{default:()=>h});var a=s(96540),d=s(22022),l=s(71563),i=s(24589),r=s(30532);function n(e,t){return(0,i.rJ)(e,"users",t,"cv_versions")}async function c(e,t){return(0,r.qk)((0,r.KR)(e,t))}var o=s(96788),u=s(46681),m=s(89921),x=s(74848);function f(e){if(e instanceof Error)return e.message;if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return String(e)}}function v(e){if(!e)return"0 B";const t=["B","KB","MB","GB"];let s=0,a=e;for(;a>=1024&&s<t.length-1;)a/=1024,s+=1;return`${a.toFixed(0===s?0:1)} ${t[s]}`}function h(){const{t:e}=(0,d.Bd)(),{userId:t,isAuthReady:s}=(0,l.gv)(),[h,p]=(0,a.useState)(null),[g,j]=(0,a.useState)(""),[N,y]=(0,a.useState)(""),[b,B]=(0,a.useState)([]),[w,C]=(0,a.useState)(!1),[k,S]=(0,a.useState)(!1),[_,U]=(0,a.useState)(null),V=(0,a.useMemo)(()=>!!t&&!!h&&!w,[t,h,w]),$=(0,a.useMemo)(()=>k?(0,x.jsx)("div",{className:"text-sm text-muted-foreground",children:e("cvBuilder.list.loading","Loading…")}):0===b.length?(0,x.jsx)("div",{className:"text-sm text-muted-foreground",children:e("cvBuilder.list.empty","No CV versions yet.")}):(0,x.jsx)("div",{className:"divide-y divide-border",children:b.map(t=>(0,x.jsxs)("div",{className:"py-sm flex items-center gap-md",children:[(0,x.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,x.jsx)("div",{className:"truncate text-sm font-medium text-foreground",children:t.data.label||t.data.fileName}),(0,x.jsxs)("div",{className:"truncate text-xs text-muted-foreground",children:[t.data.fileName," • ",v(t.data.sizeBytes)," • ",t.data.mimeType]}),t.data.notes?(0,x.jsx)("div",{className:"mt-1 text-xs text-muted-foreground",children:t.data.notes}):null]}),t.downloadUrl?(0,x.jsx)("a",{className:"text-sm font-medium text-foreground hover:underline",href:t.downloadUrl,target:"_blank",rel:"noreferrer",children:e("cvBuilder.list.open","Open")}):(0,x.jsx)("span",{className:"text-xs text-muted-foreground",children:"—"})]},t.id))}),[k,b,e]);async function z(){if(t){S(!0),U(null);try{const e=await async function(e,t,s=50){const a=(0,i.P)(n(e,t),(0,i.My)("createdAt","desc"));return(await(0,i.GG)(a)).docs.slice(0,s).map(e=>({id:e.id,data:e.data()}))}(o.db,t,50),s=[];for(const t of e){let e;try{e=await c(o.I,t.data.filePath)}catch{e=void 0}s.push({id:t.id,data:t.data,downloadUrl:e})}B(s)}catch(e){U(f(e))}finally{S(!1)}}}return(0,a.useEffect)(()=>{s&&t&&z()},[s,t]),(0,x.jsxs)("div",{className:"space-y-lg",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-xl font-semibold text-foreground",children:e("cvBuilder.title","CV Builder")}),(0,x.jsx)("div",{className:"text-sm text-muted-foreground",children:e("cvBuilder.subtitle","Upload CV versions and link them to applications.")})]}),_?(0,x.jsx)(u.Wz,{message:_}):null,(0,x.jsxs)(u.Zp,{padding:"md",shadow:"sm",className:"space-y-md",children:[(0,x.jsx)("div",{className:"text-base font-semibold",children:e("cvBuilder.upload.title","Upload CV")}),(0,x.jsxs)("div",{className:"grid grid-cols-1 gap-md md:grid-cols-2",children:[(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)("div",{className:"text-xs text-muted-foreground",children:e("cvBuilder.upload.file","File")}),(0,x.jsx)("input",{type:"file",accept:".pdf,.doc,.docx",onChange:e=>p(e.target.files?.[0]??null)}),h?(0,x.jsxs)("div",{className:"text-xs text-muted-foreground",children:[h.name," • ",v(h.size)]}):null]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)("div",{className:"text-xs text-muted-foreground",children:e("cvBuilder.upload.label","Label")}),(0,x.jsx)(m.pd,{preset:"default",value:g,onChange:e=>j(e.target.value),placeholder:e("cvBuilder.upload.labelPh","e.g. Frontend CV v3")})]})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)("div",{className:"text-xs text-muted-foreground",children:e("cvBuilder.upload.notes","Notes")}),(0,x.jsx)("textarea",{className:"w-full min-h-[70px] rounded-md border border-border bg-background px-3 py-2 text-sm text-foreground outline-none focus:ring-2 focus:ring-ring",value:N,onChange:e=>y(e.target.value),placeholder:e("cvBuilder.upload.notesPh","Optional notes…")})]}),(0,x.jsx)("div",{className:"flex justify-end",children:(0,x.jsx)(u.$n,{disabled:!V,onClick:async function(){if(t&&h){C(!0),U(null);try{await async function(e,t,s,a){const d=(0,i.H9)(n(e,s)).id,l=i.Dc.now(),c=a.file,o=c.name.replace(/\s+/g,"_"),u=`users/${s}/cv_versions/${d}/${o}`,m=(0,r.KR)(t,u);await(0,r.D)(m,c);const x=(0,i.H9)(e,"users",s,"cv_versions",d),f={createdAt:l,updatedAt:l,label:a.label?.trim()||o,filePath:u,fileName:c.name,sizeBytes:c.size,mimeType:c.type||"application/octet-stream",notes:a.notes?.trim()||void 0};return await(0,i.BN)(x,f),d}(o.db,o.I,t,{file:h,label:g.trim()||void 0,notes:N.trim()||void 0}),p(null),j(""),y(""),await z()}catch(e){U(f(e))}finally{C(!1)}}},children:w?e("cvBuilder.upload.uploading","Uploading…"):e("cvBuilder.upload.upload","Upload")})})]}),(0,x.jsxs)(u.Zp,{padding:"md",shadow:"sm",className:"space-y-sm",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsx)("div",{className:"text-base font-semibold",children:e("cvBuilder.list.title","CV Versions")}),(0,x.jsx)(u.$n,{size:"sm",variant:"outline",disabled:!t||k,onClick:z,children:e("cvBuilder.list.refresh","Refresh")})]}),$]})]})}}}]);
//# sourceMappingURL=3274.e02f6f47.chunk.js.map